# Project_Akyuu 开发计划

## 目标

实现在线相册系统，覆盖注册登录、公共/私有相册、媒体上传预览下载、评论回复、成员管理等核心需求。

## 环境

- JDK 1.8
- Spring Boot（后端）
- Vue（前端）
- PostgreSQL（192.168.1.6:5432/Akyuu, postgres/sakuya）

## 里程碑与任务

M1：后端基础与公共相册

- 任务 1：初始化 Spring Boot 项目骨架，集成 Web/Validation/JPA/Security
- 任务 2：接 PostgreSQL，配置实体与迁移（初期使用 JPA 自动建表）
- 任务 3：实现注册/登录（JWT）与用户信息接口
- 任务 4：实现相册实体/接口（公共相册列表/详情/创建/更新/删除）
- 任务 5：实现媒体上传/预览/下载与本地存储
- 任务 6：全局异常与统一响应

M2：私有相册与成员管理

- 任务 7：相册成员表与接口（邀请/移除）
- 任务 8：私有相册鉴权访问控制（所有者/成员）

M3：评论模块

- 任务 9：媒体评论/回复 CRUD，树形结构
- 任务 10：评论权限控制与审核删除

M4：前端与验收

- 任务 11：初始化 Vue 项目，路由与状态管理
- 任务 12：登录/注册界面
- 任务 13：公共相册与媒体列表、上传、预览页
- 任务 14：私有相册与成员管理
- 任务 15：评论组件与交互
- 任务 16：对接后端 API，自测与验收

## 计划排期（示意）

- 第 1-2 天：M1
- 第 3 天：M2
- 第 4 天：M3
- 第 5-6 天：M4

## 风险与对策

- 文件存储容量与清理：限制大小与周期清理
- 视频预览转码：先原生播放，后续接入转码服务
- 安全：JWT 保护、上传类型白名单、限流

## 进度记录

- 2025-10-13 17:00: 已完成项目框架搭建
- 2025-10-13 18:00: 已完成实体定义，包括: User、Album、AlbumMember、Media、Comment。
- 2025-10-13 18:30: 已完成 Repository 接口定义，包括: UserRepository、AlbumRepository、MediaRepository。
- 2025-10-13 18:40: 已完成全局异常处理: GlobalExceptionHandler。
- 2025-10-13 19:00: 已完成 JWT 相关内容，包括: JwtUtil、UserPrincipal、UserDetailsService、JwtAuthenticationFilter、SecurityConfig、RegisterRequest、LoginRequest、AuthResponse、AuthController。
- 2025-10-13 19:30: 已完成 Album 相关内容，包括: AlbumRequest、AlbumController。
- 2025-10-13 19:40: 已完成 M1 全部内容。
- 2025-10-14 20:09: 已完成 M2 阶段，完成内容:
  ✅ 已完成的任务
  1. 优化 AlbumMember 实体 - 添加了外键关系和联合唯一约束
  2. 创建 AlbumMemberRepository 接口 - 包含成员查询和管理功能
  3. 实现相册成员管理接口：
  - POST /api/v1/albums/{albumId}/members - 邀请成员
  - DELETE /api/v1/albums/{albumId}/members/{memberUserId} - 移除成员
  - GET /api/v1/albums/{albumId}/members - 获取成员列表
  4. 实现私有相册鉴权访问控制：
  - 在 AlbumMemberService 中添加权限检查方法
  - 更新 MediaService，添加私有相册访问控制
  - 更新 AlbumController 的 getAlbum 方法，验证访问权限
  5. 更新 AlbumController - 集成了私有相册的访问控制机制
     🔧 核心功能实现
     权限控制逻辑：
  - 公共相册：所有登录用户可访问
  - 私有相册：仅相册所有者和成员可访问
  - 上传权限：相册访问权限 + 上传权限检查
  - 删除权限：仅上传者或相册所有者可删除媒体文件
    成员管理功能：
  - 所有者可邀请其他用户成为成员
  - 所有者可移除成员，成员可自行退出
  - 防止重复邀请和所有者移除保护
- 2025-10-14 20:30: 已完成 M3 阶段，具体内容包括：
  ✅ 已完成的任务
  1. 优化 Comment 实体 - 添加了外键关系和树形结构支持，包括 parent 和 replies 关系
  2. 创建 CommentRepository 接口 - 包含评论查询、统计和权限检查功能
  3. 实现 CommentService - 处理评论业务逻辑，包括：
  - 创建评论和回复
  - 获取媒体评论（树形结构）
  - 更新评论内容
  - 删除评论及权限控制
  - 评论统计功能
  4. 创建 CommentController - 实现完整的评论 API 接口
  5. 实现评论权限控制 - 集成了完整的权限管理系统
     🔧 核心功能实现
     评论 API 接口：
  - POST /api/v1/media/{mediaId}/comments - 创建评论/回复
  - GET /api/v1/media/{mediaId}/comments - 获取媒体评论（树形结构）
  - PATCH /api/v1/comments/{commentId} - 更新评论内容
  - DELETE /api/v1/comments/{commentId} - 删除评论
  - GET /api/v1/media/{mediaId}/comments/count - 评论数量统计
  - GET /api/v1/users/{userId}/comments - 获取用户评论
    权限控制逻辑：
  - 创建评论：需要相册访问权限
  - 修改评论：仅评论作者可修改
  - 删除评论：评论作者、媒体上传者、相册所有者都可删除
  - 树形结构：支持多级回复，自动加载回复链
    树形评论设计：
  - 支持无限级回复
  - 自动加载顶级评论及其所有回复
  - 保持评论时间顺序
  - 完整的父子关系管理
